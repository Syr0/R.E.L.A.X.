/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => RelaxPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  regexPairs: [],
  ignoreLinks: true,
  ignoreURLs: true
};
var Mutex = class {
  constructor() {
    this._promise = null;
    this._resolve = null;
  }
  async lock() {
    if (this._promise)
      await this._promise;
    this._promise = new Promise((resolve) => {
      this._resolve = resolve;
    });
  }
  unlock() {
    if (this._resolve) {
      this._resolve();
      this._resolve = null;
      this._promise = null;
    }
  }
  async runExclusive(callback) {
    await this.lock();
    try {
      return await callback();
    } finally {
      this.unlock();
    }
  }
};
var RelaxSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const keyValueContainer = containerEl.createEl("div");
    keyValueContainer.style.display = "flex";
    keyValueContainer.style.flexDirection = "column";
    function validateContent(content) {
      const regex = /\[\[(.+?)\]\]/g;
      return !regex.test(content);
    }
    function applyValidationStyle(textarea) {
      if (validateContent(textarea.value)) {
        const accentColor = getComputedStyle(document.documentElement).getPropertyValue("--color-accent").trim();
        textarea.style.borderColor = accentColor;
      } else {
        textarea.style.borderColor = "red";
      }
    }
    document.addEventListener("DOMContentLoaded", (event) => {
      const modalButton = document.querySelector("#openModalButton");
      modalButton.addEventListener("click", function() {
        const modal = document.querySelector(".modal");
        const textarea = modal.querySelector("textarea");
        applyValidationStyle(textarea);
        textarea.addEventListener("input", function() {
          applyValidationStyle(textarea);
        });
      });
    });
    const validateRegexInput = (input) => {
      let errorMsg = "";
      try {
        let reg = new RegExp(input.value);
        let groupCount = (input.value.match(/\((?!\?)/g) || []).length;
        if (groupCount > 1) {
          input.style.border = "2px solid red";
          errorMsg = "More than one group detected.";
        } else {
          input.style.border = "";
        }
      } catch (e) {
        input.style.border = "2px solid red";
        errorMsg = "Invalid regex.";
      }
      const errorElement = input.nextSibling;
      if (errorElement && errorElement.classList.contains("regex-error")) {
        errorElement.textContent = errorMsg;
      } else {
        const span = document.createElement("span");
        span.className = "regex-error";
        span.textContent = errorMsg;
        input.parentNode.insertBefore(span, input.nextSibling);
      }
    };
    const addKeyValue = (key, value, isActive = false) => {
      const row = keyValueContainer.createEl("div");
      row.style.display = "flex";
      row.style.alignItems = "center";
      const dragHandle = row.createEl("span", { className: "drag-handle", text: "\u2630" });
      const activeCheckbox = row.createEl("input", { className: "active-checkbox" });
      activeCheckbox.type = "checkbox";
      activeCheckbox.checked = isActive;
      row.appendChild(activeCheckbox);
      const keyInput = row.createEl("input", { className: "key-input", placeholder: "Description-Key", value: key != null ? key : "" });
      const valueInput = row.createEl("input", { className: "value-input", placeholder: "Regexp", value: value != null ? value : "" });
      keyInput.style.marginRight = "10px";
      valueInput.style.marginRight = "10px";
      row.createEl("button", { text: "Delete", className: `delete-button-${key != null ? key : Date.now()}` }).addEventListener("click", () => {
        row.remove();
        updateRegexOrderFromDOM.call(this);
      });
      if (dragHandle)
        makeDraggable(row, dragHandle);
      valueInput.addEventListener("input", () => validateRegexInput(valueInput));
    };
    containerEl.createEl("button", { text: "Add Regexp" }).addEventListener("click", () => addKeyValue());
    for (const { isActive, key, regex } of this.plugin.settings.regexPairs) {
      addKeyValue(key, regex, isActive);
    }
    let startY = 0;
    let startTop = 0;
    let initialOffsetY = 0;
    function updateRegexOrderFromDOM(pluginObj) {
      const regexPairs = [];
      keyValueContainer.querySelectorAll("div").forEach((row) => {
        const activeCheckboxInput = row.querySelector('input[type="checkbox"]');
        const keyInput = row.querySelector('input[placeholder="Description-Key"]');
        const valueInput = row.querySelector('input[placeholder="Regexp"]');
        if (keyInput && valueInput && activeCheckboxInput) {
          const key = keyInput.value;
          const value = valueInput.value;
          const isActive = activeCheckboxInput.checked;
          regexPairs.push({ isActive, key, regex: value });
        }
      });
      if (pluginObj.plugin && pluginObj.plugin.settings) {
        pluginObj.plugin.settings.regexPairs = regexPairs;
        pluginObj.plugin.saveSettings();
      } else {
        console.error("Plugin or settings not available");
      }
    }
    let dragElement = null;
    let currentIndex = null;
    let newIndex = null;
    function makeDraggable(element, dragHandle) {
      if (!dragHandle) {
        console.error("Drag handle not found!", element.innerHTML);
        return;
      }
      dragHandle.addEventListener("mousedown", function(e) {
        e.preventDefault();
        e.stopPropagation();
        const settingsContainerTop = document.querySelector(".vertical-tab-content-container").getBoundingClientRect().top;
        const elementRect = element.getBoundingClientRect();
        initialOffsetY = e.clientY - elementRect.top + settingsContainerTop;
        currentIndex = [...element.parentElement.children].indexOf(element);
        dragElement = element;
        dragElement.style.zIndex = "1000";
        dragElement.style.position = "absolute";
        const newTop = e.clientY - initialOffsetY;
        dragElement.style.top = `${newTop}px`;
        document.addEventListener("mousemove", onDragMove);
        document.addEventListener("mouseup", onDragEnd);
      });
    }
    function onDragMove(e) {
      if (dragElement) {
        const newTop = e.clientY - initialOffsetY;
        dragElement.style.top = `${newTop}px`;
        newIndex = null;
        let closestDistance = Infinity;
        [...dragElement.parentElement.children].forEach((child, idx) => {
          if (child !== dragElement) {
            const rect = child.getBoundingClientRect();
            const distance = Math.abs(rect.top + rect.height / 2 - e.clientY);
            if (distance < closestDistance) {
              closestDistance = distance;
              newIndex = idx;
            }
          }
        });
      }
    }
    function onDragEnd() {
      if (dragElement) {
        dragElement.style.position = "";
        dragElement.style.top = "";
        dragElement.style.zIndex = "";
        if (newIndex !== null && currentIndex !== null && newIndex !== currentIndex) {
          const parent = dragElement.parentElement;
          if (newIndex >= parent.children.length) {
            parent.appendChild(dragElement);
          } else {
            parent.insertBefore(dragElement, parent.children[newIndex + (newIndex > currentIndex ? 1 : 0)]);
          }
        }
        dragElement = null;
        updateRegexOrderFromDOM.call(this);
        document.removeEventListener("mousemove", onDragMove);
        document.removeEventListener("mouseup", onDragEnd);
        reorderElements();
        currentIndex = null;
        newIndex = null;
      }
    }
    function reorderElements() {
      keyValueContainer.querySelectorAll("div").forEach((row) => {
        row.style.top = "";
      });
    }
    new import_obsidian.Setting(containerEl).setName("Ignore Links").addToggle((toggle) => {
      var _a;
      toggle.setValue((_a = this.plugin.settings.ignoreLinks) != null ? _a : true).onChange(async (value) => {
        this.plugin.settings.ignoreLinks = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian.Setting(containerEl).setName("Ignore URLs").addToggle((toggle) => {
      var _a;
      toggle.setValue((_a = this.plugin.settings.ignoreURLs) != null ? _a : true).onChange(async (value) => {
        this.plugin.settings.ignoreURLs = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian.Setting(containerEl).setName("Defang URLs").addToggle((toggle) => {
      var _a;
      toggle.setValue((_a = this.plugin.settings.defangURLs) != null ? _a : true).onChange(async (value) => {
        this.plugin.settings.defangURLs = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian.Setting(containerEl).setName("Save").addButton((button) => {
      button.setButtonText("Save").onClick(async () => {
        updateRegexOrderFromDOM(this);
        const closeButton = document.querySelector(".modal-close-button");
        if (closeButton) {
          closeButton.click();
        }
      });
    });
  }
};
function containsValidLink(line, match) {
  const linkRegex = /\[\[.*?\]\]/g;
  let result;
  while ((result = linkRegex.exec(line)) !== null) {
    if (result.index <= line.indexOf(match) && linkRegex.lastIndex >= line.indexOf(match) + match.length) {
      return true;
    }
  }
  return false;
}
var RelaxPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.progress = 0;
    this.mutex = new Mutex();
  }
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new RelaxSettingTab(this.app, this));
    this.addCommand({ id: "Relax-command", name: "Relax", callback: () => this.addBrackets() });
    this.registerEvent(
      this.app.workspace.on("file-menu", (menu, file) => {
        menu.addItem((item) => {
          item.setTitle("R.E.L.A.X.").setIcon("curly-braces").onClick(async () => {
            this.addBrackets();
          });
        });
      })
    );
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor, view) => {
        menu.addItem((item) => {
          item.setTitle("R.E.L.A.X.").setIcon("curly-braces").onClick(async () => {
            this.addBrackets();
          });
        });
      })
    );
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor, view) => {
        menu.addItem((item) => {
          item.setTitle("Remove all brackets").setIcon("curly-braces").onClick(async () => {
            this.removeBrackets();
          });
        });
      })
    );
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    new import_obsidian.Notice("Config saved!");
  }
  removeBracketsInSelection(content) {
    return content.replace(/\[|\]/g, "");
  }
  async addBracketsForFile(noteFilePath = "") {
    await this.processFileContent(noteFilePath, (content) => this.updateSelection(content, this.settings));
  }
  async removeBracketsinFile(noteFilePath = "") {
    await this.processFileContent(noteFilePath, this.removeBracketsInSelection);
  }
  async processFileContent(noteFilePath, contentProcessor) {
    let noteFile;
    let fileContent = "";
    if (noteFilePath !== "") {
      noteFile = this.app.vault.getAbstractFileByPath(noteFilePath);
      if (!noteFile) {
        new import_obsidian.Notice(`No file found at the given path: ${noteFilePath}`);
        return;
      }
      fileContent = await this.app.vault.read(noteFile);
    } else {
      const leaf = this.app.workspace.activeLeaf || this.app.workspace.getLeaf();
      noteFile = this.app.workspace.getActiveFile();
      if (!noteFile && leaf.view.focusedItem && !leaf.view.focusedItem.collapsible) {
        noteFile = leaf.view.focusedItem.file;
      }
      if (!noteFile) {
        new import_obsidian.Notice("No file selected. Please select a markdown file from the editor or navigation bar.");
        return;
      }
      if (!(leaf.view instanceof import_obsidian.MarkdownView)) {
        new import_obsidian.Notice("Please open a markdown file or select a folder");
        return;
      }
      fileContent = await this.app.vault.read(noteFile);
    }
    const updatedContent = contentProcessor(fileContent);
    await this.app.vault.modify(noteFile, updatedContent);
  }
  updateSelection(content, settings) {
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    const excludedExtensions = /\.(exe|lnk|xls|md|sh|elf|bin|tmp|doc|odt|docx|pdf|yara|dll|txt)$/;
    const fangMap = {
      "[.]": ".",
      "[:]": ":"
    };
    if (settings.defangURLs) {
      content = content.replace(/\[\.\]|\[\:\]/g, (char) => fangMap[char]);
    }
    let updatedText = "";
    const lines = content.split("\n");
    lines.forEach((line, index) => {
      for (const { isActive, key, regex } of settings.regexPairs) {
        if (!isActive) {
          continue;
        }
        const compiledRegex = new RegExp(regex, "g");
        line = line.replace(compiledRegex, (match, ...args) => {
          const groups = args.slice(0, -2).filter((g) => g !== void 0);
          const capturedValue = groups[0];
          if (!capturedValue)
            return match;
          if (settings.ignoreLinks && containsValidLink(line, capturedValue)) {
            return match;
          }
          if (settings.ignoreURLs) {
            const urls = Array.from(line.matchAll(urlRegex), (m) => m[0]);
            let ignoreCurrentMatch = false;
            for (const url of urls) {
              if (!excludedExtensions.test(url) && url.includes(capturedValue)) {
                ignoreCurrentMatch = true;
                break;
              }
            }
            if (ignoreCurrentMatch) {
              return match;
            }
          }
          return match.replace(capturedValue, `[[${capturedValue}]]`);
        });
      }
      updatedText += line;
      if (index !== lines.length - 1) {
        updatedText += "\n";
      }
    });
    return updatedText;
  }
  async processMarkdownContent(action) {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      new import_obsidian.Notice("Please open a markdown file or select a folder");
      return;
    }
    const view = activeLeaf.view;
    if (!view) {
      new import_obsidian.Notice("Unknown item selected. Please select a markdown file or folder");
      return;
    }
    if (view instanceof import_obsidian.MarkdownView) {
      const selection = view.editor.getSelection();
      if (selection && selection.trim().length !== 0) {
        let updatedSelection;
        if (action === "removeBrackets") {
          updatedSelection = this.removeBracketsInSelection(selection);
          new import_obsidian.Notice("Removed brackets from selection!");
        } else {
          updatedSelection = this.updateSelection(selection, this.settings);
          new import_obsidian.Notice("Added brackets in selection!");
        }
        view.editor.replaceSelection(updatedSelection);
        new import_obsidian.Notice(action === "removeBrackets" ? "Removed brackets from selection!" : "Updated content in selection!");
      } else {
        if (action === "removeBrackets") {
          await this.removeBracketsinFile();
          new import_obsidian.Notice("Removed brackets from entire file!");
        } else {
          await this.addBracketsForFile();
          new import_obsidian.Notice("Added brackets on entire file!");
        }
      }
    }
  }
  async removeBrackets() {
    await this.processMarkdownContent("removeBrackets");
  }
  async addBrackets() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf) {
      new import_obsidian.Notice("Please open a markdown file or select a folder");
      return;
    }
    const view = activeLeaf.view;
    if (!view) {
      new import_obsidian.Notice("Unknown item selected. Please select a markdown file or folder");
      return;
    }
    if (view instanceof import_obsidian.MarkdownView) {
      const editor = view.editor;
      const selection = editor.getSelection();
      if (selection && selection.trim().length !== 0) {
        const updatedSelection = this.updateSelection(selection, this.settings);
        editor.replaceSelection(updatedSelection);
        new import_obsidian.Notice("Added brackets in selection!");
      } else {
        await this.addBracketsForFile();
        new import_obsidian.Notice("Updated entire file!");
      }
    } else if (view.focusedItem && view.focusedItem.collapsible) {
      const folderPath = view.focusedItem.file.path;
      await this.addBracketsForFolder(folderPath);
    } else if (view.focusedItem && !view.focusedItem.collapsible) {
      const filePath = view.focusedItem.file.path;
      await this.addBracketsForFile(filePath);
    } else {
      new import_obsidian.Notice("No markdown file or folder is currently selected. Please select one.");
    }
  }
  async addBracketsForFolder(folderPath) {
    const files = this.app.vault.getMarkdownFiles().filter((file) => file.path.startsWith(folderPath));
    const totalFiles = files.length;
    let processingNotice = new import_obsidian.Notice(`Processing ${totalFiles} files...`, totalFiles * 1e3);
    for (const [index, file] of files.entries()) {
      await this.mutex.runExclusive(async () => {
        await this.addBracketsForFile(file.path);
        processingNotice.setMessage(`Processing file ${index + 1} of ${totalFiles}`);
      });
    }
    processingNotice.hide();
    new import_obsidian.Notice(`All ${totalFiles} files in the folder processed.`);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtBcHAsIE1hcmtkb3duVmlldywgTm90aWNlLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFRGaWxlfSBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5pbnRlcmZhY2UgUmVsYXhQbHVnaW5TZXR0aW5ncyB7XHJcblx0cmVnZXhQYWlyczogQXJyYXk8e2lzQWN0aXZlOiBib29sZWFuLCBrZXk6IHN0cmluZywgcmVnZXg6IHN0cmluZywgIH0+O1xyXG5cdGlnbm9yZUxpbmtzPzogYm9vbGVhbjtcclxuXHRpZ25vcmVVUkxzPzogYm9vbGVhbjtcclxuXHRkZWZhbmdVUkxzPzogYm9vbGVhbjtcclxufVxyXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBSZWxheFBsdWdpblNldHRpbmdzID0ge1xyXG5cdHJlZ2V4UGFpcnM6IFtdLFxyXG5cdGlnbm9yZUxpbmtzOiB0cnVlLFxyXG5cdGlnbm9yZVVSTHM6IHRydWVcclxufTtcclxuY2xhc3MgTXV0ZXgge1xyXG5cdHByaXZhdGUgX3Byb21pc2U6IFByb21pc2U8dm9pZD4gfCBudWxsID0gbnVsbDtcclxuXHRwcml2YXRlIF9yZXNvbHZlOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcclxuXHJcblx0YXN5bmMgbG9jaygpIHtcclxuXHRcdGlmICh0aGlzLl9wcm9taXNlKSBhd2FpdCB0aGlzLl9wcm9taXNlO1xyXG5cdFx0dGhpcy5fcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcblx0XHRcdHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHR1bmxvY2soKSB7XHJcblx0XHRpZiAodGhpcy5fcmVzb2x2ZSkge1xyXG5cdFx0XHR0aGlzLl9yZXNvbHZlKCk7XHJcblx0XHRcdHRoaXMuX3Jlc29sdmUgPSBudWxsO1xyXG5cdFx0XHR0aGlzLl9wcm9taXNlID0gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGFzeW5jIHJ1bkV4Y2x1c2l2ZTxUPihjYWxsYmFjazogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG5cdFx0YXdhaXQgdGhpcy5sb2NrKCk7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRyZXR1cm4gYXdhaXQgY2FsbGJhY2soKTtcclxuXHRcdH0gZmluYWxseSB7XHJcblx0XHRcdHRoaXMudW5sb2NrKCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBSZWxheFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuXHRwbHVnaW46IFJlbGF4UGx1Z2luO1xyXG5cdGtleVZhbHVlQ29udGFpbmVyOiBIVE1MRGl2RWxlbWVudDtcclxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBSZWxheFBsdWdpbikge1xyXG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xyXG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcblx0fVxyXG5cdGRpc3BsYXkoKSB7XHJcblx0XHRjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHRcdGNvbnN0IGtleVZhbHVlQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRWwoXCJkaXZcIik7XHJcblx0XHRrZXlWYWx1ZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xyXG5cdFx0a2V5VmFsdWVDb250YWluZXIuc3R5bGUuZmxleERpcmVjdGlvbiA9ICdjb2x1bW4nO1xyXG5cdFx0ZnVuY3Rpb24gdmFsaWRhdGVDb250ZW50KGNvbnRlbnQpIHtcclxuXHRcdFx0Y29uc3QgcmVnZXggPSAvXFxbXFxbKC4rPylcXF1cXF0vZztcclxuXHRcdFx0cmV0dXJuICFyZWdleC50ZXN0KGNvbnRlbnQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGFwcGx5VmFsaWRhdGlvblN0eWxlKHRleHRhcmVhKSB7XHJcblx0XHRcdGlmICh2YWxpZGF0ZUNvbnRlbnQodGV4dGFyZWEudmFsdWUpKSB7XHJcblx0XHRcdFx0Y29uc3QgYWNjZW50Q29sb3IgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudClcclxuXHRcdFx0XHRcdC5nZXRQcm9wZXJ0eVZhbHVlKCctLWNvbG9yLWFjY2VudCcpLnRyaW0oKTtcclxuXHRcdFx0XHR0ZXh0YXJlYS5zdHlsZS5ib3JkZXJDb2xvciA9IGFjY2VudENvbG9yXHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGV4dGFyZWEuc3R5bGUuYm9yZGVyQ29sb3IgPSBcInJlZFwiO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG5cdFx0XHRjb25zdCBtb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjb3Blbk1vZGFsQnV0dG9uXCIpO1xyXG5cclxuXHRcdFx0bW9kYWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxcIik7XHJcblx0XHRcdFx0Y29uc3QgdGV4dGFyZWEgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwidGV4dGFyZWFcIik7XHJcblxyXG5cdFx0XHRcdGFwcGx5VmFsaWRhdGlvblN0eWxlKHRleHRhcmVhKTtcclxuXHJcblx0XHRcdFx0dGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdGFwcGx5VmFsaWRhdGlvblN0eWxlKHRleHRhcmVhKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRjb25zdCB2YWxpZGF0ZVJlZ2V4SW5wdXQgPSAoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpID0+IHtcclxuXHRcdFx0bGV0IGVycm9yTXNnID0gJyc7XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0bGV0IHJlZyA9IG5ldyBSZWdFeHAoaW5wdXQudmFsdWUpO1xyXG5cdFx0XHRcdGxldCBncm91cENvdW50ID0gKGlucHV0LnZhbHVlLm1hdGNoKC9cXCgoPyFcXD8pL2cpIHx8IFtdKS5sZW5ndGg7XHJcblx0XHRcdFx0aWYgKGdyb3VwQ291bnQgPiAxKSB7XHJcblx0XHRcdFx0XHRpbnB1dC5zdHlsZS5ib3JkZXIgPSAnMnB4IHNvbGlkIHJlZCc7XHJcblx0XHRcdFx0XHRlcnJvck1zZyA9ICdNb3JlIHRoYW4gb25lIGdyb3VwIGRldGVjdGVkLic7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGlucHV0LnN0eWxlLmJvcmRlciA9ICcnO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdGlucHV0LnN0eWxlLmJvcmRlciA9ICcycHggc29saWQgcmVkJztcclxuXHRcdFx0XHRlcnJvck1zZyA9ICdJbnZhbGlkIHJlZ2V4Lic7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IGVycm9yRWxlbWVudCA9IGlucHV0Lm5leHRTaWJsaW5nO1xyXG5cdFx0XHRpZiAoZXJyb3JFbGVtZW50ICYmIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3JlZ2V4LWVycm9yJykpIHtcclxuXHRcdFx0XHRlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1zZztcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG5cdFx0XHRcdHNwYW4uY2xhc3NOYW1lID0gJ3JlZ2V4LWVycm9yJztcclxuXHRcdFx0XHRzcGFuLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XHJcblx0XHRcdFx0aW5wdXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc3BhbiwgaW5wdXQubmV4dFNpYmxpbmcpO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdFx0Y29uc3QgYWRkS2V5VmFsdWUgPSAoa2V5Pzogc3RyaW5nLCB2YWx1ZT86IHN0cmluZywgaXNBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZSkgPT4ge1xyXG5cdFx0XHRjb25zdCByb3cgPSBrZXlWYWx1ZUNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiKTtcclxuXHRcdFx0cm93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XHJcblx0XHRcdHJvdy5zdHlsZS5hbGlnbkl0ZW1zID0gJ2NlbnRlcic7XHJcblxyXG5cdFx0XHRjb25zdCBkcmFnSGFuZGxlID0gcm93LmNyZWF0ZUVsKFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJkcmFnLWhhbmRsZVwiLCB0ZXh0OiBcIlx1MjYzMFwiIH0pO1xyXG5cdFx0XHRjb25zdCBhY3RpdmVDaGVja2JveCA9IHJvdy5jcmVhdGVFbChcImlucHV0XCIsIHsgY2xhc3NOYW1lOiBcImFjdGl2ZS1jaGVja2JveFwiIH0pO1xyXG5cdFx0XHRhY3RpdmVDaGVja2JveC50eXBlID0gXCJjaGVja2JveFwiO1xyXG5cdFx0XHRhY3RpdmVDaGVja2JveC5jaGVja2VkID0gaXNBY3RpdmU7XHJcblx0XHRcdHJvdy5hcHBlbmRDaGlsZChhY3RpdmVDaGVja2JveCk7XHJcblxyXG5cdFx0XHRjb25zdCBrZXlJbnB1dCA9IHJvdy5jcmVhdGVFbChcImlucHV0XCIsIHsgY2xhc3NOYW1lOiBcImtleS1pbnB1dFwiLCBwbGFjZWhvbGRlcjogXCJEZXNjcmlwdGlvbi1LZXlcIiwgdmFsdWU6IGtleSA/PyAnJyB9KTtcclxuXHRcdFx0Y29uc3QgdmFsdWVJbnB1dCA9IHJvdy5jcmVhdGVFbChcImlucHV0XCIsIHsgY2xhc3NOYW1lOiBcInZhbHVlLWlucHV0XCIsIHBsYWNlaG9sZGVyOiBcIlJlZ2V4cFwiLCB2YWx1ZTogdmFsdWUgPz8gJycgfSk7XHJcblx0XHRcdGtleUlucHV0LnN0eWxlLm1hcmdpblJpZ2h0ID0gJzEwcHgnO1xyXG5cdFx0XHR2YWx1ZUlucHV0LnN0eWxlLm1hcmdpblJpZ2h0ID0gJzEwcHgnO1xyXG5cclxuXHRcdFx0cm93LmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJEZWxldGVcIiwgY2xhc3NOYW1lOiBgZGVsZXRlLWJ1dHRvbi0ke2tleSA/PyBEYXRlLm5vdygpfWAgfSlcclxuXHRcdFx0XHQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuXHRcdFx0XHRcdHJvdy5yZW1vdmUoKTtcclxuXHRcdFx0XHRcdHVwZGF0ZVJlZ2V4T3JkZXJGcm9tRE9NLmNhbGwodGhpcyk7XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRpZiAoZHJhZ0hhbmRsZSkgbWFrZURyYWdnYWJsZShyb3csIGRyYWdIYW5kbGUpO1xyXG5cdFx0XHR2YWx1ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gdmFsaWRhdGVSZWdleElucHV0KHZhbHVlSW5wdXQpKTtcclxuXHRcdH07XHJcblxyXG5cdFx0Y29udGFpbmVyRWwuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIkFkZCBSZWdleHBcIiB9KS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gYWRkS2V5VmFsdWUoKSk7XHJcblxyXG5cdFx0Zm9yIChjb25zdCB7aXNBY3RpdmUsIGtleSwgcmVnZXggfSBvZiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZWdleFBhaXJzKSB7XHJcblx0XHRcdGFkZEtleVZhbHVlKGtleSwgcmVnZXgsIGlzQWN0aXZlKTtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgc3RhcnRZID0gMDtcclxuXHRcdGxldCBzdGFydFRvcCA9IDA7XHJcblx0XHRsZXQgaW5pdGlhbE9mZnNldFkgPSAwXHJcblx0XHRmdW5jdGlvbiB1cGRhdGVSZWdleE9yZGVyRnJvbURPTShwbHVnaW5PYmopIHtcclxuXHJcblx0XHRcdGNvbnN0IHJlZ2V4UGFpcnMgPSBbXTtcclxuXHRcdFx0a2V5VmFsdWVDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcImRpdlwiKS5mb3JFYWNoKHJvdyA9PiB7XHJcblxyXG5cdFx0XHRcdGNvbnN0IGFjdGl2ZUNoZWNrYm94SW5wdXQgPSByb3cucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJyk7XHJcblx0XHRcdFx0Y29uc3Qga2V5SW5wdXQgPSByb3cucXVlcnlTZWxlY3RvcignaW5wdXRbcGxhY2Vob2xkZXI9XCJEZXNjcmlwdGlvbi1LZXlcIl0nKTtcclxuXHRcdFx0XHRjb25zdCB2YWx1ZUlucHV0ID0gcm93LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3BsYWNlaG9sZGVyPVwiUmVnZXhwXCJdJyk7XHJcblxyXG5cclxuXHRcdFx0XHRpZiAoa2V5SW5wdXQgJiYgdmFsdWVJbnB1dCAmJiBhY3RpdmVDaGVja2JveElucHV0KSB7XHJcblx0XHRcdFx0XHRjb25zdCBrZXkgPSBrZXlJbnB1dC52YWx1ZTtcclxuXHRcdFx0XHRcdGNvbnN0IHZhbHVlID0gdmFsdWVJbnB1dC52YWx1ZTtcclxuXHRcdFx0XHRcdGNvbnN0IGlzQWN0aXZlID0gYWN0aXZlQ2hlY2tib3hJbnB1dC5jaGVja2VkO1xyXG5cdFx0XHRcdFx0cmVnZXhQYWlycy5wdXNoKHsgaXNBY3RpdmUsIGtleSwgcmVnZXg6IHZhbHVlIH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHRcdGlmIChwbHVnaW5PYmoucGx1Z2luICYmIHBsdWdpbk9iai5wbHVnaW4uc2V0dGluZ3MpIHtcclxuXHRcdFx0XHRwbHVnaW5PYmoucGx1Z2luLnNldHRpbmdzLnJlZ2V4UGFpcnMgPSByZWdleFBhaXJzO1xyXG5cdFx0XHRcdHBsdWdpbk9iai5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlBsdWdpbiBvciBzZXR0aW5ncyBub3QgYXZhaWxhYmxlXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cdFx0bGV0IGRyYWdFbGVtZW50ID0gbnVsbDtcclxuXHRcdGxldCBjdXJyZW50SW5kZXggPSBudWxsO1xyXG5cdFx0bGV0IG5ld0luZGV4ID0gbnVsbDtcclxuXHJcblxyXG5cdFx0ZnVuY3Rpb24gbWFrZURyYWdnYWJsZShlbGVtZW50LCBkcmFnSGFuZGxlKSB7XHJcblx0XHRcdGlmICghZHJhZ0hhbmRsZSkge1xyXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJEcmFnIGhhbmRsZSBub3QgZm91bmQhXCIsIGVsZW1lbnQuaW5uZXJIVE1MKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGRyYWdIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuXHRcdFx0XHRjb25zdCBzZXR0aW5nc0NvbnRhaW5lclRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmVydGljYWwtdGFiLWNvbnRlbnQtY29udGFpbmVyXCIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuXHRcdFx0XHRjb25zdCBlbGVtZW50UmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcblx0XHRcdFx0aW5pdGlhbE9mZnNldFkgPSBlLmNsaWVudFkgLSBlbGVtZW50UmVjdC50b3AgKyBzZXR0aW5nc0NvbnRhaW5lclRvcDtcclxuXHRcdFx0XHRjdXJyZW50SW5kZXggPSBbLi4uZWxlbWVudC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuXS5pbmRleE9mKGVsZW1lbnQpO1xyXG5cclxuXHRcdFx0XHRkcmFnRWxlbWVudCA9IGVsZW1lbnQ7XHJcblx0XHRcdFx0ZHJhZ0VsZW1lbnQuc3R5bGUuekluZGV4ID0gJzEwMDAnO1xyXG5cdFx0XHRcdGRyYWdFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuXHJcblx0XHRcdFx0Y29uc3QgbmV3VG9wID0gZS5jbGllbnRZIC0gaW5pdGlhbE9mZnNldFk7XHJcblx0XHRcdFx0ZHJhZ0VsZW1lbnQuc3R5bGUudG9wID0gYCR7bmV3VG9wfXB4YDtcclxuXHJcblx0XHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25EcmFnTW92ZSk7XHJcblx0XHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uRHJhZ0VuZCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIG9uRHJhZ01vdmUoZSkge1xyXG5cdFx0XHRpZiAoZHJhZ0VsZW1lbnQpIHtcclxuXHRcdFx0XHRjb25zdCBuZXdUb3AgPSBlLmNsaWVudFkgLSBpbml0aWFsT2Zmc2V0WTtcclxuXHRcdFx0XHRkcmFnRWxlbWVudC5zdHlsZS50b3AgPSBgJHtuZXdUb3B9cHhgO1xyXG5cclxuXHRcdFx0XHRuZXdJbmRleCA9IG51bGw7XHJcblx0XHRcdFx0bGV0IGNsb3Nlc3REaXN0YW5jZSA9IEluZmluaXR5O1xyXG5cdFx0XHRcdFsuLi5kcmFnRWxlbWVudC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuXS5mb3JFYWNoKChjaGlsZCwgaWR4KSA9PiB7XHJcblx0XHRcdFx0XHRpZiAoY2hpbGQgIT09IGRyYWdFbGVtZW50KSB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IHJlY3QgPSBjaGlsZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHRcdFx0XHRcdFx0Y29uc3QgZGlzdGFuY2UgPSBNYXRoLmFicyhyZWN0LnRvcCArIHJlY3QuaGVpZ2h0IC8gMiAtIGUuY2xpZW50WSk7XHJcblx0XHRcdFx0XHRcdGlmIChkaXN0YW5jZSA8IGNsb3Nlc3REaXN0YW5jZSkge1xyXG5cdFx0XHRcdFx0XHRcdGNsb3Nlc3REaXN0YW5jZSA9IGRpc3RhbmNlO1xyXG5cdFx0XHRcdFx0XHRcdG5ld0luZGV4ID0gaWR4O1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBvbkRyYWdFbmQoKSB7XHJcblx0XHRcdGlmIChkcmFnRWxlbWVudCkge1xyXG5cdFx0XHRcdGRyYWdFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJyc7XHJcblx0XHRcdFx0ZHJhZ0VsZW1lbnQuc3R5bGUudG9wID0gJyc7XHJcblx0XHRcdFx0ZHJhZ0VsZW1lbnQuc3R5bGUuekluZGV4ID0gJyc7XHJcblxyXG5cdFx0XHRcdGlmIChuZXdJbmRleCAhPT0gbnVsbCAmJiBjdXJyZW50SW5kZXggIT09IG51bGwgJiYgbmV3SW5kZXggIT09IGN1cnJlbnRJbmRleCkge1xyXG5cdFx0XHRcdFx0Y29uc3QgcGFyZW50ID0gZHJhZ0VsZW1lbnQucGFyZW50RWxlbWVudDtcclxuXHRcdFx0XHRcdGlmIChuZXdJbmRleCA+PSBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcblx0XHRcdFx0XHRcdHBhcmVudC5hcHBlbmRDaGlsZChkcmFnRWxlbWVudCk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRwYXJlbnQuaW5zZXJ0QmVmb3JlKGRyYWdFbGVtZW50LCBwYXJlbnQuY2hpbGRyZW5bbmV3SW5kZXggKyAobmV3SW5kZXggPiBjdXJyZW50SW5kZXggPyAxIDogMCldKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGRyYWdFbGVtZW50ID0gbnVsbDtcclxuXHRcdFx0XHR1cGRhdGVSZWdleE9yZGVyRnJvbURPTS5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uRHJhZ01vdmUpO1xyXG5cdFx0XHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBvbkRyYWdFbmQpO1xyXG5cdFx0XHRcdHJlb3JkZXJFbGVtZW50cygpO1xyXG5cdFx0XHRcdGN1cnJlbnRJbmRleCA9IG51bGw7XHJcblx0XHRcdFx0bmV3SW5kZXggPSBudWxsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gcmVvcmRlckVsZW1lbnRzKCkge1xyXG5cdFx0XHRrZXlWYWx1ZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiZGl2XCIpLmZvckVhY2goKHJvdykgPT4ge1xyXG5cdFx0XHRcdHJvdy5zdHlsZS50b3AgPSAnJztcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdC5zZXROYW1lKCdJZ25vcmUgTGlua3MnKVxyXG5cdFx0XHQuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB7XHJcblx0XHRcdFx0dG9nZ2xlXHJcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlTGlua3MgPz8gdHJ1ZSlcclxuXHRcdFx0XHRcdC5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XHJcblx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZUxpbmtzID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdC5zZXROYW1lKCdJZ25vcmUgVVJMcycpXHJcblx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHtcclxuXHRcdFx0XHR0b2dnbGVcclxuXHRcdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pZ25vcmVVUkxzID8/IHRydWUpXHJcblx0XHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5pZ25vcmVVUkxzID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdC5zZXROYW1lKCdEZWZhbmcgVVJMcycpXHJcblx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHtcclxuXHRcdFx0XHR0b2dnbGVcclxuXHRcdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhbmdVUkxzID8/IHRydWUpXHJcblx0XHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhbmdVUkxzID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdC5zZXROYW1lKFwiU2F2ZVwiKVxyXG5cdFx0XHQuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XHJcblx0XHRcdFx0YnV0dG9uLnNldEJ1dHRvblRleHQoXCJTYXZlXCIpXHJcblx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdHVwZGF0ZVJlZ2V4T3JkZXJGcm9tRE9NKHRoaXMpXHJcblx0XHRcdFx0XHRcdGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLWNsb3NlLWJ1dHRvbicpO1xyXG5cdFx0XHRcdFx0XHRpZiAoY2xvc2VCdXR0b24pIHtcclxuXHRcdFx0XHRcdFx0XHRjbG9zZUJ1dHRvbi5jbGljaygpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0fSk7XHJcblx0fVxyXG59XHJcbmZ1bmN0aW9uIGNvbnRhaW5zVmFsaWRMaW5rKGxpbmU6IHN0cmluZywgbWF0Y2g6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG5cdGNvbnN0IGxpbmtSZWdleCA9IC9cXFtcXFsuKj9cXF1cXF0vZztcclxuXHRsZXQgcmVzdWx0O1xyXG5cdHdoaWxlICgocmVzdWx0ID0gbGlua1JlZ2V4LmV4ZWMobGluZSkpICE9PSBudWxsKSB7XHJcblx0XHRpZiAocmVzdWx0LmluZGV4IDw9IGxpbmUuaW5kZXhPZihtYXRjaCkgJiYgbGlua1JlZ2V4Lmxhc3RJbmRleCA+PSBsaW5lLmluZGV4T2YobWF0Y2gpICsgbWF0Y2gubGVuZ3RoKSB7XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlbGF4UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcclxuXHRzZXR0aW5nczogUmVsYXhQbHVnaW5TZXR0aW5ncztcclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBSZWxheFNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7aWQ6ICdSZWxheC1jb21tYW5kJywgbmFtZTogJ1JlbGF4JywgY2FsbGJhY2s6ICgpID0+IHRoaXMuYWRkQnJhY2tldHMoKX0pO1xyXG5cdFx0dGhpcy5yZWdpc3RlckV2ZW50KFxyXG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJmaWxlLW1lbnVcIiwgKG1lbnUsIGZpbGUpID0+IHtcclxuXHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcclxuXHRcdFx0XHRcdGl0ZW1cclxuXHRcdFx0XHRcdFx0LnNldFRpdGxlKFwiUi5FLkwuQS5YLlwiKVxyXG5cdFx0XHRcdFx0XHQuc2V0SWNvbihcImN1cmx5LWJyYWNlc1wiKVxyXG5cdFx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5hZGRCcmFja2V0cygpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSlcclxuXHRcdCk7XHJcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoXHJcblx0XHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImVkaXRvci1tZW51XCIsIChtZW51LCBlZGl0b3IsIHZpZXcpID0+IHtcclxuXHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcclxuXHRcdFx0XHRcdGl0ZW1cclxuXHRcdFx0XHRcdFx0LnNldFRpdGxlKFwiUi5FLkwuQS5YLlwiKVxyXG5cdFx0XHRcdFx0XHQuc2V0SWNvbihcImN1cmx5LWJyYWNlc1wiKVxyXG5cdFx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5hZGRCcmFja2V0cygpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSlcclxuXHRcdCk7XHJcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoXHJcblx0XHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImVkaXRvci1tZW51XCIsIChtZW51LCBlZGl0b3IsIHZpZXcpID0+IHtcclxuXHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcclxuXHRcdFx0XHRcdGl0ZW1cclxuXHRcdFx0XHRcdFx0LnNldFRpdGxlKFwiUmVtb3ZlIGFsbCBicmFja2V0c1wiKVxyXG5cdFx0XHRcdFx0XHQuc2V0SWNvbihcImN1cmx5LWJyYWNlc1wiKVxyXG5cdFx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5yZW1vdmVCcmFja2V0cygpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSlcclxuXHRcdCk7XHJcblx0fVxyXG5cdG9udW5sb2FkKCkge1xyXG5cdH1cclxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuXHR9XHJcblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuXHRcdG5ldyBOb3RpY2UoJ0NvbmZpZyBzYXZlZCEnKTtcclxuXHR9XHJcblxyXG5cdHJlbW92ZUJyYWNrZXRzSW5TZWxlY3Rpb24oY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiBjb250ZW50LnJlcGxhY2UoL1xcW3xcXF0vZywgJycpO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgYWRkQnJhY2tldHNGb3JGaWxlKG5vdGVGaWxlUGF0aCA9IFwiXCIpIHtcclxuXHRcdGF3YWl0IHRoaXMucHJvY2Vzc0ZpbGVDb250ZW50KG5vdGVGaWxlUGF0aCwgKGNvbnRlbnQpID0+IHRoaXMudXBkYXRlU2VsZWN0aW9uKGNvbnRlbnQsIHRoaXMuc2V0dGluZ3MpKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHJlbW92ZUJyYWNrZXRzaW5GaWxlKG5vdGVGaWxlUGF0aCA9IFwiXCIpIHtcclxuXHRcdGF3YWl0IHRoaXMucHJvY2Vzc0ZpbGVDb250ZW50KG5vdGVGaWxlUGF0aCwgdGhpcy5yZW1vdmVCcmFja2V0c0luU2VsZWN0aW9uKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHByb2Nlc3NGaWxlQ29udGVudChub3RlRmlsZVBhdGg6IHN0cmluZywgY29udGVudFByb2Nlc3NvcjogKGNvbnRlbnQ6IHN0cmluZykgPT4gc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcblx0XHRsZXQgbm90ZUZpbGU7XHJcblxyXG5cdFx0bGV0IGZpbGVDb250ZW50ID0gXCJcIjtcclxuXHJcblx0XHRpZiAobm90ZUZpbGVQYXRoICE9PSBcIlwiKSB7XHJcblx0XHRcdG5vdGVGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG5vdGVGaWxlUGF0aCk7XHJcblx0XHRcdGlmICghbm90ZUZpbGUpIHtcclxuXHRcdFx0XHRuZXcgTm90aWNlKGBObyBmaWxlIGZvdW5kIGF0IHRoZSBnaXZlbiBwYXRoOiAke25vdGVGaWxlUGF0aH1gKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0ZmlsZUNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKG5vdGVGaWxlIGFzIFRGaWxlKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZiB8fCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpO1xyXG5cdFx0XHRub3RlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XHJcblxyXG5cdFx0XHRpZiAoIW5vdGVGaWxlICYmIGxlYWYudmlldy5mb2N1c2VkSXRlbSAmJiAhbGVhZi52aWV3LmZvY3VzZWRJdGVtLmNvbGxhcHNpYmxlKSB7XHJcblx0XHRcdFx0bm90ZUZpbGUgPSBsZWFmLnZpZXcuZm9jdXNlZEl0ZW0uZmlsZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFub3RlRmlsZSkge1xyXG5cdFx0XHRcdG5ldyBOb3RpY2UoJ05vIGZpbGUgc2VsZWN0ZWQuIFBsZWFzZSBzZWxlY3QgYSBtYXJrZG93biBmaWxlIGZyb20gdGhlIGVkaXRvciBvciBuYXZpZ2F0aW9uIGJhci4nKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghKGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykpIHtcclxuXHRcdFx0XHRuZXcgTm90aWNlKCdQbGVhc2Ugb3BlbiBhIG1hcmtkb3duIGZpbGUgb3Igc2VsZWN0IGEgZm9sZGVyJyk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmaWxlQ29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQobm90ZUZpbGUgYXMgVEZpbGUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IHVwZGF0ZWRDb250ZW50ID0gY29udGVudFByb2Nlc3NvcihmaWxlQ29udGVudCk7XHJcblx0XHRhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkobm90ZUZpbGUgYXMgVEZpbGUsIHVwZGF0ZWRDb250ZW50KTtcclxuXHR9XHJcblxyXG5cdHVwZGF0ZVNlbGVjdGlvbihjb250ZW50OiBzdHJpbmcsIHNldHRpbmdzOiBSZWxheFBsdWdpblNldHRpbmdzKTogc3RyaW5nIHtcclxuXHRcdGNvbnN0IHVybFJlZ2V4ID0gLyhodHRwcz86XFwvXFwvW15cXHNdKykvZztcclxuXHRcdGNvbnN0IGV4Y2x1ZGVkRXh0ZW5zaW9ucyA9IC9cXC4oZXhlfGxua3x4bHN8bWR8c2h8ZWxmfGJpbnx0bXB8ZG9jfG9kdHxkb2N4fHBkZnx5YXJhfGRsbHx0eHQpJC87XHJcblx0XHRjb25zdCBmYW5nTWFwID0ge1xyXG5cdFx0XHQnWy5dJzogJy4nLFxyXG5cdFx0XHQnWzpdJzogJzonXHJcblx0XHR9O1xyXG5cdFx0aWYgKHNldHRpbmdzLmRlZmFuZ1VSTHMpIHtcclxuXHRcdFx0Y29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvXFxbXFwuXFxdfFxcW1xcOlxcXS9nLCBjaGFyID0+IGZhbmdNYXBbY2hhcl0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCB1cGRhdGVkVGV4dCA9ICcnO1xyXG5cdFx0Y29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KFwiXFxuXCIpO1xyXG5cclxuXHRcdGxpbmVzLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XHJcblx0XHRcdGZvciAoY29uc3QgeyBpc0FjdGl2ZSxrZXksIHJlZ2V4IH0gb2Ygc2V0dGluZ3MucmVnZXhQYWlycykge1xyXG5cdFx0XHRcdGlmICghaXNBY3RpdmUpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Y29uc3QgY29tcGlsZWRSZWdleCA9IG5ldyBSZWdFeHAocmVnZXgsICdnJyk7XHJcblx0XHRcdFx0bGluZSA9IGxpbmUucmVwbGFjZShjb21waWxlZFJlZ2V4LCAobWF0Y2gsIC4uLmFyZ3MpID0+IHtcclxuXHRcdFx0XHRcdGNvbnN0IGdyb3VwcyA9IGFyZ3Muc2xpY2UoMCwgLTIpLmZpbHRlcihnID0+IGcgIT09IHVuZGVmaW5lZCk7XHJcblx0XHRcdFx0XHRjb25zdCBjYXB0dXJlZFZhbHVlID0gZ3JvdXBzWzBdO1xyXG5cclxuXHRcdFx0XHRcdGlmICghY2FwdHVyZWRWYWx1ZSkgcmV0dXJuIG1hdGNoO1xyXG5cclxuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5pZ25vcmVMaW5rcyAmJiBjb250YWluc1ZhbGlkTGluayhsaW5lLCBjYXB0dXJlZFZhbHVlKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gbWF0Y2g7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmlnbm9yZVVSTHMpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgdXJscyA9IEFycmF5LmZyb20obGluZS5tYXRjaEFsbCh1cmxSZWdleCksIG0gPT4gbVswXSk7XHJcblx0XHRcdFx0XHRcdGxldCBpZ25vcmVDdXJyZW50TWF0Y2ggPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0XHRcdGZvciAoY29uc3QgdXJsIG9mIHVybHMpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoIWV4Y2x1ZGVkRXh0ZW5zaW9ucy50ZXN0KHVybCkgJiYgdXJsLmluY2x1ZGVzKGNhcHR1cmVkVmFsdWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZ25vcmVDdXJyZW50TWF0Y2ggPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoaWdub3JlQ3VycmVudE1hdGNoKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1hdGNoO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0cmV0dXJuIG1hdGNoLnJlcGxhY2UoY2FwdHVyZWRWYWx1ZSwgYFtbJHtjYXB0dXJlZFZhbHVlfV1dYCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0dXBkYXRlZFRleHQgKz0gbGluZTtcclxuXHJcblx0XHRcdGlmIChpbmRleCAhPT0gbGluZXMubGVuZ3RoIC0gMSkge1xyXG5cdFx0XHRcdHVwZGF0ZWRUZXh0ICs9IFwiXFxuXCI7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiB1cGRhdGVkVGV4dDtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHByb2Nlc3NNYXJrZG93bkNvbnRlbnQoYWN0aW9uOiBcInJlbW92ZUJyYWNrZXRzXCIgfCBcImFkZEJyYWNrZXRzXCIpIHtcclxuXHRcdGNvbnN0IGFjdGl2ZUxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZjtcclxuXHJcblx0XHRpZiAoIWFjdGl2ZUxlYWYpIHtcclxuXHRcdFx0bmV3IE5vdGljZSgnUGxlYXNlIG9wZW4gYSBtYXJrZG93biBmaWxlIG9yIHNlbGVjdCBhIGZvbGRlcicpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgdmlldyA9IGFjdGl2ZUxlYWYudmlldztcclxuXHRcdGlmICghdmlldykge1xyXG5cdFx0XHRuZXcgTm90aWNlKCdVbmtub3duIGl0ZW0gc2VsZWN0ZWQuIFBsZWFzZSBzZWxlY3QgYSBtYXJrZG93biBmaWxlIG9yIGZvbGRlcicpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpIHtcclxuXHRcdFx0Y29uc3Qgc2VsZWN0aW9uID0gdmlldy5lZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XHJcblxyXG5cdFx0XHRpZiAoc2VsZWN0aW9uICYmIHNlbGVjdGlvbi50cmltKCkubGVuZ3RoICE9PSAwKSB7XHJcblx0XHRcdFx0bGV0IHVwZGF0ZWRTZWxlY3Rpb247XHJcblx0XHRcdFx0aWYgKGFjdGlvbiA9PT0gJ3JlbW92ZUJyYWNrZXRzJykge1xyXG5cdFx0XHRcdFx0dXBkYXRlZFNlbGVjdGlvbiA9IHRoaXMucmVtb3ZlQnJhY2tldHNJblNlbGVjdGlvbihzZWxlY3Rpb24pO1xyXG5cdFx0XHRcdFx0bmV3IE5vdGljZSgnUmVtb3ZlZCBicmFja2V0cyBmcm9tIHNlbGVjdGlvbiEnKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dXBkYXRlZFNlbGVjdGlvbiA9IHRoaXMudXBkYXRlU2VsZWN0aW9uKHNlbGVjdGlvbiwgdGhpcy5zZXR0aW5ncyk7XHJcblx0XHRcdFx0XHRuZXcgTm90aWNlKCdBZGRlZCBicmFja2V0cyBpbiBzZWxlY3Rpb24hJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZpZXcuZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24odXBkYXRlZFNlbGVjdGlvbik7XHJcblx0XHRcdFx0bmV3IE5vdGljZShhY3Rpb24gPT09ICdyZW1vdmVCcmFja2V0cycgPyAnUmVtb3ZlZCBicmFja2V0cyBmcm9tIHNlbGVjdGlvbiEnIDogJ1VwZGF0ZWQgY29udGVudCBpbiBzZWxlY3Rpb24hJyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKGFjdGlvbiA9PT0gJ3JlbW92ZUJyYWNrZXRzJykge1xyXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5yZW1vdmVCcmFja2V0c2luRmlsZSgpO1xyXG5cdFx0XHRcdFx0bmV3IE5vdGljZSgnUmVtb3ZlZCBicmFja2V0cyBmcm9tIGVudGlyZSBmaWxlIScpO1xyXG5cdFx0XHRcdH0gZWxzZSB7IFxyXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5hZGRCcmFja2V0c0ZvckZpbGUoKTtcclxuXHRcdFx0XHRcdG5ldyBOb3RpY2UoJ0FkZGVkIGJyYWNrZXRzIG9uIGVudGlyZSBmaWxlIScpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0YXN5bmMgcmVtb3ZlQnJhY2tldHMoKSB7XHJcblx0XHRhd2FpdCB0aGlzLnByb2Nlc3NNYXJrZG93bkNvbnRlbnQoJ3JlbW92ZUJyYWNrZXRzJyk7XHJcblx0fVxyXG5cclxuXHRhc3luYyBhZGRCcmFja2V0cygpIHtcclxuXHRcdGNvbnN0IGFjdGl2ZUxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZjtcclxuXHJcblx0XHRpZiAoIWFjdGl2ZUxlYWYpIHtcclxuXHRcdFx0bmV3IE5vdGljZSgnUGxlYXNlIG9wZW4gYSBtYXJrZG93biBmaWxlIG9yIHNlbGVjdCBhIGZvbGRlcicpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgdmlldyA9IGFjdGl2ZUxlYWYudmlldztcclxuXHRcdGlmICghdmlldykge1xyXG5cdFx0XHRuZXcgTm90aWNlKCdVbmtub3duIGl0ZW0gc2VsZWN0ZWQuIFBsZWFzZSBzZWxlY3QgYSBtYXJrZG93biBmaWxlIG9yIGZvbGRlcicpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpIHtcclxuXHRcdFx0Y29uc3QgZWRpdG9yID0gdmlldy5lZGl0b3I7XHJcblx0XHRcdGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcclxuXHJcblx0XHRcdGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLnRyaW0oKS5sZW5ndGggIT09IDApIHtcclxuXHRcdFx0XHRjb25zdCB1cGRhdGVkU2VsZWN0aW9uID0gdGhpcy51cGRhdGVTZWxlY3Rpb24oc2VsZWN0aW9uLCB0aGlzLnNldHRpbmdzKTtcclxuXHRcdFx0XHRlZGl0b3IucmVwbGFjZVNlbGVjdGlvbih1cGRhdGVkU2VsZWN0aW9uKTtcclxuXHRcdFx0XHRuZXcgTm90aWNlKCdBZGRlZCBicmFja2V0cyBpbiBzZWxlY3Rpb24hJyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0YXdhaXQgdGhpcy5hZGRCcmFja2V0c0ZvckZpbGUoKTtcclxuXHRcdFx0XHRuZXcgTm90aWNlKCdVcGRhdGVkIGVudGlyZSBmaWxlIScpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKHZpZXcuZm9jdXNlZEl0ZW0gJiYgdmlldy5mb2N1c2VkSXRlbS5jb2xsYXBzaWJsZSkge1xyXG5cdFx0XHRjb25zdCBmb2xkZXJQYXRoID0gdmlldy5mb2N1c2VkSXRlbS5maWxlLnBhdGg7XHJcblx0XHRcdGF3YWl0IHRoaXMuYWRkQnJhY2tldHNGb3JGb2xkZXIoZm9sZGVyUGF0aCk7XHJcblx0XHR9IGVsc2UgaWYgKHZpZXcuZm9jdXNlZEl0ZW0gJiYgIXZpZXcuZm9jdXNlZEl0ZW0uY29sbGFwc2libGUpIHtcclxuXHRcdFx0Y29uc3QgZmlsZVBhdGggPSB2aWV3LmZvY3VzZWRJdGVtLmZpbGUucGF0aDtcclxuXHRcdFx0YXdhaXQgdGhpcy5hZGRCcmFja2V0c0ZvckZpbGUoZmlsZVBhdGgpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0bmV3IE5vdGljZSgnTm8gbWFya2Rvd24gZmlsZSBvciBmb2xkZXIgaXMgY3VycmVudGx5IHNlbGVjdGVkLiBQbGVhc2Ugc2VsZWN0IG9uZS4nKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cclxuXHRwcml2YXRlIHByb2dyZXNzID0gMDtcclxuXHRwcml2YXRlIG11dGV4ID0gbmV3IE11dGV4KCk7XHJcblxyXG5cdGFzeW5jIGFkZEJyYWNrZXRzRm9yRm9sZGVyKGZvbGRlclBhdGg6IHN0cmluZykge1xyXG5cdFx0Y29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkuZmlsdGVyKGZpbGUgPT4gZmlsZS5wYXRoLnN0YXJ0c1dpdGgoZm9sZGVyUGF0aCkpO1xyXG5cdFx0Y29uc3QgdG90YWxGaWxlcyA9IGZpbGVzLmxlbmd0aDtcclxuXHJcblx0XHRsZXQgcHJvY2Vzc2luZ05vdGljZSA9IG5ldyBOb3RpY2UoYFByb2Nlc3NpbmcgJHt0b3RhbEZpbGVzfSBmaWxlcy4uLmAsdG90YWxGaWxlcyoxMDAwKTtcclxuXHJcblx0XHRmb3IgKGNvbnN0IFtpbmRleCwgZmlsZV0gb2YgZmlsZXMuZW50cmllcygpKSB7XHJcblx0XHRcdGF3YWl0IHRoaXMubXV0ZXgucnVuRXhjbHVzaXZlKGFzeW5jICgpID0+IHtcclxuXHRcdFx0XHRhd2FpdCB0aGlzLmFkZEJyYWNrZXRzRm9yRmlsZShmaWxlLnBhdGgpO1xyXG5cdFx0XHRcdHByb2Nlc3NpbmdOb3RpY2Uuc2V0TWVzc2FnZShgUHJvY2Vzc2luZyBmaWxlICR7aW5kZXggKyAxfSBvZiAke3RvdGFsRmlsZXN9YCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHByb2Nlc3NpbmdOb3RpY2UuaGlkZSgpO1xyXG5cdFx0bmV3IE5vdGljZShgQWxsICR7dG90YWxGaWxlc30gZmlsZXMgaW4gdGhlIGZvbGRlciBwcm9jZXNzZWQuYCk7XHJcblx0fVxyXG59XHJcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBa0Y7QUFRbEYsSUFBTSxtQkFBd0M7QUFBQSxFQUM3QyxZQUFZLENBQUM7QUFBQSxFQUNiLGFBQWE7QUFBQSxFQUNiLFlBQVk7QUFDYjtBQUNBLElBQU0sUUFBTixNQUFZO0FBQUEsRUFBWjtBQUNDLFNBQVEsV0FBaUM7QUFDekMsU0FBUSxXQUFnQztBQUFBO0FBQUEsRUFFeEMsTUFBTSxPQUFPO0FBQ1osUUFBSSxLQUFLO0FBQVUsWUFBTSxLQUFLO0FBQzlCLFNBQUssV0FBVyxJQUFJLFFBQVEsQ0FBQyxZQUFZO0FBQ3hDLFdBQUssV0FBVztBQUFBLElBQ2pCLENBQUM7QUFBQSxFQUNGO0FBQUEsRUFFQSxTQUFTO0FBQ1IsUUFBSSxLQUFLLFVBQVU7QUFDbEIsV0FBSyxTQUFTO0FBQ2QsV0FBSyxXQUFXO0FB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
